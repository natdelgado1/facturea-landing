---
import about from "../../../data/about.json";
import Badge from "../UI/Badge.astro";
import TitlePrimary from "../UI/TitlePrimary.astro";
---

<!-- ¬øPor qu√© elegir Facturea? -->
<section class="overflow-hidden relative pt-20 bg-gradient-to-b from-gray-50 to-white sm:py-24 md:py-32" id="por-que-facturea">
    <!-- Elementos decorativos flotantes -->
    <div class="floating-decorations">
        <div class="floating-element floating-element--1"></div>
        <div class="floating-element floating-element--2"></div>
        <div class="floating-element floating-element--3"></div>
        <div class="floating-element floating-element--4"></div>
    </div>
    
    <div class="container relative z-10 px-4 mx-auto sm:px-6">
        <div class="mx-auto max-w-6xl text-center">
            
            <!-- Badge superior -->
            <div class="gsap-badge">
            <Badge text={about.badgeText} />
            </div>
            
            <!-- T√≠tulo principal con gradiente -->
            <TitlePrimary text={about.title} boldText={about.titleBold} />

            <!-- Subt√≠tulo -->
            <p class="px-4 mx-auto mb-12 max-w-4xl text-lg leading-relaxed text-gray-600 gsap-subtitle sm:text-xl md:text-2xl sm:mb-16 sm:px-0">
                {about.description} <span class="font-semibold text-primary">{about.descriptionBold}</span> 
                {about.description2} <span class="font-semibold text-secondary">{about.descriptionBold2}</span>
            </p>

            <!-- Grid de propuestas de valor -->
            <div class="grid gap-6 mb-16 sm:grid-cols-2 lg:grid-cols-3 sm:gap-8 sm:mb-20" role="list">
                {about.items.map((item, index) => (
                    <article 
                        class="h-full cursor-pointer gsap-card group" 
                        data-index={index}
                        role="listitem"
                        aria-labelledby={`feature-title-${index}`}
                    >
                        <div class="card-wrapper">
                            <div class="card-hover-bg" aria-hidden="true"></div>
                            <div class="card-content">
                                <div class="icon-container group-hover:scale-110" aria-hidden="true">
                                    <svg class="w-8 h-8 text-white sm:w-10 sm:h-10 very-short:w-6 very-short:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                </div>
                                <div class="counter-display gsap-counter" data-target={item.counterValue} data-suffix={item.counterSuffix} aria-label={`${item.counterValue} ${item.counterSuffix}`}>
                                    <span class="counter-value" aria-hidden="true">0</span><span class="counter-suffix" aria-hidden="true">{item.counterSuffix}</span>
                                </div>
                                <h3 id={`feature-title-${index}`} class="mb-3 text-xl font-bold text-gray-900 sm:text-2xl sm:mb-4">{item.title}</h3>
                                <p class="text-sm leading-relaxed text-gray-600 sm:text-base">{item.description}</p>
                            </div>
                        </div>
                    </article>
                ))}
            </div>

            <!-- CTA buttons -->
            <nav class="mt-12 gsap-cta sm:mt-16" aria-label="Acciones principales">
                <div class="flex flex-col gap-4 justify-center items-center sm:flex-row" role="group" aria-label="Botones de llamada a la acci√≥n">
                    <a 
                        class="btn btn--primary gsap-btn-primary" 
                        href={about.linkPrimaryButton} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        aria-label={`${about.textPrimaryButton} - Se abre en una nueva ventana`}
                    >
                        {about.textPrimaryButton}
                    </a>
                    <button 
                        type="button"
                        class="btn btn--secondary gsap-btn-secondary cursor-pointer relative focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" 
                        id="demo-btn"
                        aria-label="Abrir formulario para solicitar una demostraci√≥n"
                    >
                        {about.textSecondaryButton}
                    </button>
                </div>
            </nav>

            
        </div>
    </div>
  
</section>


<style>
    /* Elementos decorativos flotantes */
    .floating-decorations {
        @apply overflow-hidden absolute inset-0 pointer-events-none;
    }

    .floating-element {
        @apply absolute rounded-full blur-lg;
        will-change: transform;
    }

    .floating-element--1 {
        @apply left-4 top-10 w-20 h-20 opacity-30 bg-gradient-to-br from-primary/20 to-accent/10 sm:top-16 sm:left-6 sm:w-28 sm:h-28 sm:blur-xl sm:opacity-40 md:top-20 md:left-10 md:w-32 md:h-32;
    }

    .floating-element--2 {
        @apply right-8 top-32 w-16 h-16 opacity-40 blur-xl bg-gradient-to-br from-secondary/30 to-primary/20 sm:top-36 sm:right-12 sm:w-20 sm:h-20 sm:blur-2xl sm:opacity-50 md:top-40 md:right-20 md:w-24 md:h-24;
    }

    .floating-element--3 {
        @apply bottom-24 left-1/4 w-24 h-24 opacity-20 blur-2xl bg-gradient-to-br from-accent/15 to-secondary/10 sm:bottom-28 sm:w-32 sm:h-32 sm:blur-3xl sm:opacity-30 md:bottom-32 md:w-40 md:h-40;
    }

    .floating-element--4 {
        @apply bottom-16 right-1/3 w-20 h-20 opacity-25 blur-xl bg-gradient-to-br from-primary/25 to-accent/15 sm:bottom-20 sm:w-24 sm:h-24 sm:blur-2xl sm:opacity-35 md:bottom-24 md:w-28 md:h-28;
    }

    /* Cards optimizadas con GPU acceleration */
    .card-wrapper {
        @apply overflow-hidden relative p-6 h-full bg-gradient-to-br from-white to-gray-50 rounded-2xl border border-gray-200 transition-all duration-300 sm:rounded-3xl sm:p-8;
        transform: translate3d(0, 0, 0); /* GPU acceleration */
        will-change: transform; /* Optimizaci√≥n para animaciones */
    }

    .card-wrapper:hover {
        @apply shadow-2xl;
        transform: translate3d(0, -4px, 0) scale(1.02); /* GPU acceleration */
    }

    .card-hover-bg {
        @apply absolute inset-0 bg-gradient-to-br opacity-0 transition-opacity duration-500 from-primary/5 to-accent/5;
        will-change: opacity; /* Optimizaci√≥n para transiciones */
    }

    .group:hover .card-hover-bg {
        @apply opacity-100;
    }

    .card-content {
        @apply relative z-10;
        transform: translate3d(0, 0, 0); /* GPU acceleration */
    }

    .icon-container {
        @apply flex justify-center items-center mb-4 w-16 h-16 very-short:w-12 very-short:h-12 very-short:mb-2 bg-gradient-to-br rounded-xl transition-transform duration-300 from-primary to-secondary sm:w-20 sm:h-20 sm:rounded-2xl sm:mb-6;
        transform: translate3d(0, 0, 0); /* GPU acceleration */
        will-change: transform; /* Optimizaci√≥n para hover */
    }

    .counter-display {
        @apply mb-3 text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary transition-all duration-300 sm:text-4xl sm:mb-4;
        will-change: contents; /* Optimizaci√≥n para cambios de contenido */
    }

    /* Botones */
    .btn {
        @apply px-6 py-3 w-full text-base font-semibold rounded-xl transition-all duration-300 sm:w-auto sm:px-8 sm:py-4 sm:rounded-2xl sm:text-lg  ;
    }

    .btn:hover {
        @apply shadow-2xl;
    }

    .btn--primary {
        @apply text-white bg-gradient-to-r from-primary via-secondary to-accent;
    }

    .btn--secondary {
        @apply border-2 border-primary text-primary;
    }

    .btn--secondary:hover {
        @apply bg-primary text-white;
    }

    /* Estados iniciales para animaciones - Sin FOUC */
    .gsap-badge,
    .gsap-title,
    .gsap-subtitle,
    .gsap-card,
    .gsap-cta {
        /* Los estados iniciales los maneja JavaScript directamente */
    }

    /* Reducir motion para accesibilidad */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>

<script>
    // ‚úÖ SOLUCI√ìN SIN TYPESCRIPT - JavaScript puro que S√ç funciona
    
    // Declaraciones de tipos
    declare global {
        interface Window {
            gsap: any;
        }
        var emailjs: any;
    }
    
    // Variables globales simples
    let animationsReady = false;
    let animationsInitialized = false;
    
    // ‚úÖ OPTIMIZACI√ìN: Lazy loading de GSAP (solo core, sin ScrollTrigger)
    function loadGSAP(): Promise<void> {
        return new Promise<void>((resolve, reject) => {
            // Cache check
            if (window.gsap) {
                resolve();
                return;
            }
            
            // Preload con prefetch
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js';
            document.head.appendChild(link);
            
            // Carga din√°mica optimizada (solo GSAP core)
            const gsapScript = document.createElement('script');
            gsapScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js';
            gsapScript.async = true; // Carga as√≠ncrona
            gsapScript.onload = () => resolve();
            document.head.appendChild(gsapScript);
        });
    }

    // Funci√≥n principal - Solo hover effects y animaciones inmediatas
    async function initSimpleAnimations() {
        try {
            // ‚úÖ Cargar GSAP si no est√° disponible
            if (typeof window.gsap === 'undefined') {
                console.log('‚è≥ Cargando GSAP...');
                await loadGSAP();
            }

            // ‚úÖ Evitar inicializaci√≥n duplicada
            if (animationsInitialized) {
                console.log('‚ö†Ô∏è Animaciones ya inicializadas');
                return;
            }
                
            console.log('üöÄ Iniciando animaciones simples (sin ScrollTrigger)...');

            // ===== ANIMACIONES INMEDIATAS SIN SCROLL TRIGGER =====
            
            // Mostrar todos los elementos inmediatamente con animaci√≥n de entrada suave
            window.gsap.set('.gsap-badge, .gsap-title, .gsap-subtitle, .gsap-card, .gsap-cta', {
                opacity: 1,
                y: 0,
                scale: 1
            });

          

            // ‚úÖ Contadores animados - SIN SCROLL TRIGGER
            const counters = document.querySelectorAll('.gsap-counter');
            console.log('üîç Contadores encontrados:', counters.length);
            
            counters.forEach(function(counter, index) {
                const target = parseInt(counter.getAttribute('data-target') || '0');
                const valueElement = counter.querySelector('.counter-value');
                
                if (valueElement) {
                    // Iniciar contador inmediatamente despu√©s de un peque√±o delay
                    setTimeout(() => {
                        window.gsap.to(valueElement, {
                            innerHTML: target,
                            duration: 2,
                            ease: 'power2.out',
                            snap: { innerHTML: 1 },
                            delay: index * 0.2 // Stagger entre contadores
                        });
                    }, 1000); // Delay inicial de 1 segundo
                }
            });

            // ‚úÖ Elementos flotantes - Solo movimiento suave (sin parallax)
            document.querySelectorAll('.floating-element').forEach(function(element, index) {
                // Movimiento flotante infinito simple
                window.gsap.to(element, {
                    y: 15 + index * 5,
                    rotation: 5 + index * 2,
                    duration: 4 + index * 0.5,
                    ease: 'power1.inOut',
                    yoyo: true,
                    repeat: -1
                });
            });

            // 9. ‚úÖ Hover effects para cards
            document.querySelectorAll('.gsap-card').forEach(function(card) {
                let hoverTimeout: any;
                
                card.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    hoverTimeout = setTimeout(() => {
                        window.gsap.to(card, {
                            y: -8, scale: 1.02, duration: 0.3, ease: 'power2.out'
                        });
                    }, 50); // Throttle de 50ms
                });

                card.addEventListener('mouseleave', function() {
                    clearTimeout(hoverTimeout);
                    window.gsap.to(card, {
                        y: 0, scale: 1, duration: 0.3, ease: 'power2.out'
                    });
                });
            });

            // 10. ‚úÖ Hover effects para botones
            document.querySelectorAll('.gsap-btn-primary, .gsap-btn-secondary').forEach(function(btn) {
                btn.addEventListener('mouseenter', function() {
                    window.gsap.to(btn, {
                        scale: 1.05,
                        y: -2,
                        duration: 0.2,
                        ease: 'power2.out'
                    });
                });

                btn.addEventListener('mouseleave', function() {
                    window.gsap.to(btn, {
                        scale: 1,
                        y: 0,
                        duration: 0.2,
                        ease: 'power2.out'
                    });
                });
            });

            animationsInitialized = true;
            animationsReady = true;
            
            console.log('‚úÖ Animaciones simples inicializadas correctamente (sin ScrollTrigger)!');

        } catch (error) {
            console.error('‚ùå Error en animaciones:', error);
        }
    }

    // ===== SISTEMA DE INICIALIZACI√ìN SIMPLE =====
    
    function tryInitAnimations() {
        if (!animationsReady) {
            initSimpleAnimations();
        }
    }

    // M√∫ltiples puntos de entrada
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryInitAnimations);
    } else {
        tryInitAnimations();
    }

    // Backup tras cargar completamente
    window.addEventListener('load', function() {
        setTimeout(tryInitAnimations, 100);
    });

    // Para navegaci√≥n SPA de Astro
    document.addEventListener('astro:page-load', function() {
        animationsInitialized = false;
        animationsReady = false;
        setTimeout(tryInitAnimations, 200);
    });

    // Cleanup para navegaci√≥n SPA (simplificado)
    document.addEventListener('astro:before-preparation', function() {
        animationsInitialized = false;
        animationsReady = false;
    });

    console.log('üìã Script de animaciones cargado, esperando inicializaci√≥n...');
</script>